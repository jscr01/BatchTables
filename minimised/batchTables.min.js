var DataTableBatchApi={};DataTableBatchApi.init=function(t,e,a){var n={};a="undefined"==typeof a?{}:a;var i=function(t,e){};if(DataTableBatchApi.checkSetting(e.rowCallback,function(){i=e.rowCallback}),n.data={},n.data.selected=[],n.data.inserted={},n.data.edit={},n.data.deleted=[],n.newCount=0,n.editForm={},n.editControl,n.cacheObjects={},n.lstNumberRows=[],n.footerControls={},$(t+" tr[data-editform='true']").length>0?$(t+" tr[data-editform='true'] td").each(function(t,e){n.editForm[t]={},n.editForm[t].element=$(e).html(),void 0!==$(e).attr("data-call")&&(n.editForm[t].call=$(e).attr("data-call"),n.editForm[t].cache=!1,void 0!==$(e).attr("data-cache")&&(n.editForm[t].cache=$(e).attr("data-cache"))),0!=$(e).children("input[type='number']").length&&n.lstNumberRows.push(t)}):$(t+" thead tr th").each(function(t,e){n.editForm[t]={},n.editForm[t].element=$('<input type="text" />')}),void 0!==$(t+" tfoot[data-summary='true']")&&$(t+" tfoot[data-summary='true'] tr th").each(function(t,e){"="==$(e).text().split("")[0]&&(n.footerControls[t]={},n.footerControls[t].calculation=$(e).text().split("(")[0].replace("=","").toLowerCase(),n.footerControls[t].columnToCalc=$(e).text().split("(")[1].replace(")","").toLowerCase(),n.footerControls[t].format=void 0==$(e).attr("data-format")?!1:JSON.parse($(e).attr("data-format")),n.footerControls[t].column=t)}),n.grid=$(t).DataTable(e),n.batchSettings=a,n.domElements={},n.batchSettings.selectColumnName="undefined"==typeof n.batchSettings.selectColumnName?"#":n.batchSettings.selectColumnName,n.batchSettings.customFooter="undefined"==typeof n.batchSettings.customFooter?!1:n.batchSettings.customFooter,n.batchSettings.deleteButtonText="undefined"==typeof n.batchSettings.deleteButtonText?"Delete":n.batchSettings.deleteButtonText,n.batchSettings.deleteNewButtonText="undefined"==typeof n.batchSettings.deleteNewButtonText?n.batchSettings.deleteButtonText:n.batchSettings.deleteNewButtonText,n.batchSettings.deleteButtonCss="undefined"==typeof n.batchSettings.deleteButtonCss?null:n.batchSettings.deleteButtonCss,n.batchSettings.unDeleteButtonText="undefined"==typeof n.batchSettings.unDeleteButtonText?"Undo Delete":n.batchSettings.unDeleteButtonText,n.batchSettings.unDeleteButtonCss="undefined"==typeof n.batchSettings.unDeleteButtonCss?null:n.batchSettings.unDeleteButtonCss,n.batchSettings.actionColumnName="undefined"==typeof n.batchSettings.actionColumnName?"#":n.batchSettings.actionColumnName,n.batchSettings.additionalActions="undefined"==typeof n.batchSettings.additionalActions?[]:n.batchSettings.additionalActions,"undefined"!=typeof n.batchSettings.actions){n.domElements.actionsContainer=$("<div>"),DataTableBatchApi.checkSetting(n.batchSettings.actionsContainerId,function(){$(n.domElements.actionsContainer).attr("id",n.batchSettings.actionsContainerId)},function(){$(n.domElements.actionsContainer).attr("id","dtbBatchGridActions")}),DataTableBatchApi.checkSetting(n.batchSettings.actionsContainerClass,function(){$(n.domElements.actionsContainer).attr("class",n.batchSettings.actionsContainerClass)}),DataTableBatchApi.checkSetting(n.batchSettings.actionsContainerText,function(){$(n.domElements.actionsContainer).html(n.batchSettings.actionsContainerText)}),n.domElements.actionsSelect=$("<select>"),DataTableBatchApi.checkSetting(n.batchSettings.actionsSelectId,function(){$(n.domElements.actionsSelect).attr("id",n.batchSettings.actionsSelectId)},function(){$(n.domElements.actionsSelect).attr("id","dtbBatchGridActions_Select")}),$(n.domElements.actionsSelect).append('<option selected="selected" value="0"></option>');for(var o=0;o<n.batchSettings.actions.split(",").length;o++)$(n.domElements.actionsSelect).append('<option value="'+(o+1)+'">'+n.batchSettings.actions.split(",")[o]+"</option>");$(n.domElements.actionsContainer).append(n.domElements.actionsSelect),$(n.grid.settings()[0].nTable).before(n.domElements.actionsContainer),$("html").on("change","#"+$(n.domElements.actionsSelect).attr("id"),function(t){DataTableBatchApi.checkSetting(n.batchSettings.actionsSelectEvent,function(){n.batchSettings.actionsSelectEvent(t)}),$(n.domElements.actionsSelect).val(0)})}n.batchSettings.debug="undefined"==typeof n.batchSettings.debug?!1:n.batchSettings.debug,n.footerSetup=function(){$(t+" tfoot[data-summary='true'] tr th").each(function(t,e){var a=n.batchSettings.showSelectionBox?t-1:t;if("undefined"!=typeof n.footerControls[a]){var i,o=n.footerControls[a];i="records"===o.calculation?n.grid.data().length:DataTableBatchApi.calculations[o.calculation](n.grid.data(),n.data.deleted,o.columnToCalc,o.format),$(e).html(i)}})},n.reset=function(){n.grid.ajax.reload(),n.data.inserted={},n.data.selected=[],n.data.deleted=[],n.data.edit={}},n.batchSettings.showSelectionBox="undefined"==typeof n.batchSettings.showSelectionBox?!0:n.batchSettings.showSelectionBox,n.batchSettings.showSelectionBox&&($(n.grid.settings()[0].nTable).children("thead").children("tr").children("th:first").before("<th>"+n.batchSettings.selectColumnName+"</th>"),n.batchSettings.customFooter?$(n.grid.settings()[0].nTable).children("tfoot").children("tr").children("th:first").before("<th></th>"):$(n.grid.settings()[0].nTable).children("tfoot").children("tr").children("th:first").before("<th>"+n.batchSettings.selectColumnName+"</th>")),n.batchSettings.showActionColumn="undefined"==typeof n.batchSettings.showActionColumn?!0:n.batchSettings.showDeleteColumn,n.batchSettings.showActionColumn?($(n.grid.settings()[0].nTable).children("thead").children("tr").children("th:last").after("<th>"+n.batchSettings.actionColumnName+"</th>"),n.batchSettings.customFooter?$(n.grid.settings()[0].nTable).children("tfoot").children("tr").children("th:last").after("<th></th>"):$(n.grid.settings()[0].nTable).children("tfoot").children("tr").children("th:last").after("<th>"+n.batchSettings.actionColumnName+"</th>"),n.batchSettings.showActionsColumn=!0):n.batchSettings.showActionsColumn=!1,$(t).on("draw.dt",function(e,a){$(t+" tr td").attr("tabindex","0"),n.batchSettings.showSelectionBox&&$(t+" tr td:first-child").each(function(e,a){var i=$(a).parent().attr("id");if(void 0===$(a).attr("data-commandcell")){var o=$.inArray(i,n.data.selected)>-1?'checked="checked"':"";$(a).before('<td data-commandcell="select"><input '+o+' type="checkbox" id="chkSelection'+t+"_checkbox_"+$(a).parent().attr("id")+'"></td>')}}),n.batchSettings.showActionsColumn&&($(t+" tr.dtbNew td:last-child").each(function(e,a){if(void 0==$(a).attr("data-actioncell")){var i;i=DataTableBatchApi.generateDeleteButton(a,t,n.batchSettings.deleteNewButtonText,n.batchSettings.deleteButtonCss);for(var e=0;e<n.batchSettings.additionalActions.length;e++)("undefined"==typeof n.batchSettings.additionalActions[e].newOnly||n.batchSettings.additionalActions[e].newOnly)&&(i+=n.batchSettings.additionalActions[e].markup);$(a).after('<td data-actioncell="action">'+i+"</td>")}}),$(t+" tr:not(.dtbNew) td:last-child").each(function(e,a){if(void 0==$(a).attr("data-actioncell")){var i,o=$(a).parent().attr("id");i=-1===$.inArray(o,n.data.deleted)?DataTableBatchApi.generateDeleteButton(a,t,n.batchSettings.deleteButtonText,n.batchSettings.deleteButtonCss):DataTableBatchApi.generateDeleteButton(a,t,n.batchSettings.unDeleteButtonText,n.batchSettings.unDeleteButtonCss,!0);for(var e=0;e<n.batchSettings.additionalActions.length;e++)"undefined"==typeof n.batchSettings.additionalActions[e].newOnly&&(i+=n.batchSettings.additionalActions[e].markup);$(a).after('<td data-actioncell="action">'+i+"</td>")}}),$(t+" tr").each(function(t,e){$(e).children().each(function(t,e){for(var a=0;a<n.lstNumberRows.length;a++){var i=n.lstNumberRows[a];n.batchSettings.showSelectionBox&&(i=n.lstNumberRows[a]+1),i==t&&$(e).text(DataTableBatchApi.formatNumber($(e).text()))}})})),n.footerSetup(),"undefined"!=typeof n.batchSettings.onGridRendered&&n.batchSettings.onGridRendered(e,a),c()}),n.data.addBlank=function(){for(var t=n.grid.columns(),e={},a=0;a<t[0].length;a++)e[a]="";e.DT_RowId="dtbNew"+n.newCount,n.data.inserted[e.DT_RowId]=e,n.batchSettings.showSelectionBox&&$("[data-commandcell]").remove(),n.batchSettings.showActionsColumn&&$("[data-actioncell]").remove(),n.newCount++,n.grid.page(0).draw("page"),n.data.processNewRecord(e)},n.data.addRecord=function(t){for(var e=n.grid.columns(),a={},i=0;i<e[0].length;i++)a[i]=t[i];a.DT_RowId="dtbNew"+n.newCount,n.data.inserted[a.DT_RowId]=a,n.batchSettings.showSelectionBox&&$("[data-commandcell]").remove(),n.newCount++,n.data.processNewRecord(a)},n.data.processNewRecord=function(e){var a=n.grid.row.add(e).draw(!1).nodes(),i=$(a).children("td:last-child");if($(a).addClass("dtbNew"),n.batchSettings.showActionColumn){$(i).children("button").remove(),$(i).append(DataTableBatchApi.generateDeleteButton($(i),t,n.batchSettings.deleteNewButtonText,n.batchSettings.deleteButtonCss));for(var o=0;o<n.batchSettings.additionalActions.length;o++)("undefined"==typeof n.batchSettings.additionalActions[o].newOnly||n.batchSettings.additionalActions[o].newOnly)&&$(i).append(n.batchSettings.additionalActions[o].markup)}},$("html").on("click",t+" tbody tr td[data-commandcell]",function(t){var e=$(this).parent().attr("id"),a=$.inArray(e,n.data.selected);-1===a?(n.data.selected.push(e),n.batchSettings.showSelectionBox&&$(this).children("input").prop("checked",!0)):(n.data.selected.splice(a,1),n.batchSettings.showSelectionBox&&$(this).children("input").prop("checked",!1)),$(this).parent().toggleClass("selected"),"undefined"!=typeof n.batchSettings.onSelectionBoxClick&&n.batchSettings.onSelectionBoxClick(t,e,a),c()}),$("html").on("click",t+" tbody tr td button[data-btn='delete']",function(t){var e=$(this).parent().parent();if("delete"===$(this).attr("data-action"))$(this).html(n.batchSettings.unDeleteButtonText),$(this).attr("data-action","undelete"),$(e).attr("data-deleted",!0),null!==n.batchSettings.unDeleteButtonCss&&$(this).attr("class",n.batchSettings.unDeleteButtonCss),$(e).hasClass("dtbNew")?(delete n.data.inserted[$(e).attr("id")],n.grid.row(e).remove().draw(!1)):n.data.deleted.push($(e).attr("id"));else{$(e).removeAttr("data-deleted"),null!==n.batchSettings.DeleteButtonCss&&$(this).attr("class",n.batchSettings.DeleteButtonCss),$(this).parent().children("[data-btn='delete']").html(n.batchSettings.deleteButtonText),$(this).parent().children("[data-btn='delete']").attr("data-action","delete");var a=DataTableBatchApi.getIndex(n.data.deleted,$(e).attr("id"));n.data.deleted.splice(a,1)}n.footerSetup(),"undefined"!=typeof n.batchSettings.onDeleteButtonClick&&n.batchSettings.onDeleteButtonClick(t),c()}),$("html").on("focus",t+" tbody tr td",function(t){var e=$(this),a="undefined"!=typeof n.batchSettings.activateEditModeCondition?n.batchSettings.activateEditModeCondition(t,$(this).attr("data-editmode")):!1;if(!a&&!($(this).attr("data-commandcell")||$(this).attr("data-editmode")||$(this).attr("data-actioncell")||$(this).parent().attr("data-deleted"))){var i=$(this).text(),o=n.editForm[DataTableBatchApi.findCellPosition($(this),n.batchSettings.showSelectionBox)].element,d=$(o).attr("type");if("true"==$(o).attr("data-ishtml")&&(i=$(this).html()),$(this).attr("data-editmode","true"),"number"==d&&(i=DataTableBatchApi.deformatNumber(i)),$(this).attr("data-oldvalue",i),$(this).html(o),$(this).children("input").length>0)switch(n.editControl="input",$(this).children("input").attr("type")){case"checkbox":var l=$(this).children("input").attr("data-trueval");i==l&&$(this).children("input").attr("checked","checked");break;case"number":$($(this).children("input")).val(DataTableBatchApi.deformatNumber(i));break;default:$($(this).children("input")).val(i)}else if($(this).children("select").length>0){n.editControl="select";var s=$($(this).children("select")),r=DataTableBatchApi.findCellPosition($(this),n.batchSettings.showSelectionBox);if(void 0!==n.editForm[r].call){var h;if(n.editForm[r].cache&&"undefined"!=typeof n.cacheObjects["column"+r+"Data"])h=n.cacheObjects["column"+r+"Data"],h="undefined"!=typeof n.batchSettings.onCellListGet?n.batchSettings.onCellListGet(r,h,e):h,DataTableBatchApi.populateSelectList(s,h),s.val(i);else{var u={url:n.editForm[r].call};"undefined"!=typeof n.batchSettings.onCallForList&&n.batchSettings.onCallForList(r,u),$.ajax(u).success(function(t){var a=JSON.parse(t);n.editForm[r].cache&&(n.cacheObjects["column"+r+"Data"]=a),a="undefined"!=typeof n.batchSettings.onCellListGet?n.batchSettings.onCellListGet(r,a,e):a,DataTableBatchApi.populateSelectList(s,a),s.val(i)})}}else s.val(i)}$(this).children(n.editControl).focus(),c()}"undefined"!=typeof n.batchSettings.onCellEnter&&n.batchSettings.onCellEnter(t,a)}),$("html").on("focusout",t+" tbody tr td input,  tbody tr td select",function(e){var a=$(this).parent().attr("data-oldvalue"),i=$(t+" tbody tr td[data-editmode]").children(n.editControl),o=i.attr("type"),d=$(t+" tbody tr td[data-editmode]"),l="checkbox"==o?DataTableBatchApi.getCheckBoxValue(i):i.val(),s=l!==a,r=$(this).parent().parent().hasClass("dtbNew"),h=$(this).parent().parent().attr("id"),u=n.batchSettings.showSelectionBox?parseInt($(this).parent().index())-1:parseInt($(this).parent().index());if(s)if(r)n.data.inserted[h][u]=l;else{if("undefined"==typeof n.data.edit[h]){n.batchSettings.showSelectionBox?1:0,n.batchSettings.showSelectionBox?n.grid.columns()[0].length+1:n.grid.columns()[0].length;n.data.edit[h]=$.grep(n.grid.data(),function(t){return t.DT_RowId==h})[0]}n.data.edit[h][u]=l}"number"==o&&(l=DataTableBatchApi.formatNumber(l)),$(t+" tbody tr td[data-editmode]").html(l),$(t+" tbody tr td[data-editmode]").removeAttr("data-editmode"),"undefined"!=typeof n.batchSettings.onCellLeave&&n.batchSettings.onCellLeave(e,a,l,s,r,h,u,d),n.footerSetup(),c()});var c=function(){if(n.batchSettings.debug){var t="<div>Selected Items: <br />"+JSON.stringify(n.data.selected,null,4)+"</div>";t+="<div>New Items: <br />"+JSON.stringify(n.data.inserted,null,4)+"</div>",t+="<div>Deleted Items: <br />"+JSON.stringify(n.data.deleted,null,4)+"</div>",t+="<div>Edited Items: <br />"+JSON.stringify(n.data.edit,null,4)+"</div>",$("#dtbDebug").html(t)}};return c(),n},DataTableBatchApi.calculations={},DataTableBatchApi.calculations.sum=function(t,e,a,n){for(var i=0,o=0;o<t.length;o++)-1===$.inArray(t[o].DT_RowId,e)&&(i+=isNaN(parseFloat(t[o][a]))?0:parseFloat(t[o][a]));return n?DataTableBatchApi.formatNumber(i):i},DataTableBatchApi.calculations.average=function(t,e,a,n){for(var i,o=0,c=0;c<t.length;c++)-1===$.inArray(t[c].DT_RowId,e)&&(o+=isNaN(parseFloat(t[c][a]))?0:parseFloat(t[c][a]));return i=0==o||0==t.length?0:o/t.length,n?DataTableBatchApi.formatNumber(i):i},DataTableBatchApi.calculations.max=function(t,e,a,n){for(var i,o=[],c=0;c<t.length;c++)-1===$.inArray(t[c].DT_RowId,e)&&(isNaN(parseFloat(t[c][a]))?o.push(0):o.push(parseFloat(t[c][a])));return i=Math.max.apply(Math,o),n?DataTableBatchApi.formatNumber(i):i},DataTableBatchApi.calculations.min=function(t,e,a,n){for(var i,o=[],c=0;c<t.length;c++)-1===$.inArray(t[c].DT_RowId,e)&&(isNaN(parseFloat(t[c][a]))?o.push(0):o.push(parseFloat(t[c][a])));return i=Math.min.apply(Math,o),n?DataTableBatchApi.formatNumber(i):i},DataTableBatchApi.calculations.range=function(t,e,a,n){var i=DataTableBatchApi.calculations.max(t,e,a,!1),o=DataTableBatchApi.calculations.min(t,e,a,!1),c=i-o;return n?DataTableBatchApi.formatNumber(c):c},DataTableBatchApi.checkSetting=function(t,e,a){"undefined"==typeof t?"undefined"!=typeof a&&a():e()},DataTableBatchApi.getIndex=function(t,e){for(var a=null,n=0;n<t.length;n++)if(t[n]===e){a=n;break}return a},DataTableBatchApi.generateDeleteButton=function(t,e,a,n,i){n="undefined"==typeof n?"":'class="'+n+'"',i="undefined"==typeof i?!1:i;var o=i?"undelete":"delete";return'<button type="button" '+n+' data-action="'+o+'" data-btn="delete" id="btnDelete'+e+"_button_"+$(t).parent().attr("id")+'">'+a+"</button>"},DataTableBatchApi.findCellPosition=function(t,e){var a=$(t).index();return e&&a--,a},DataTableBatchApi.populateSelectList=function(t,e){for(var a=0;a<e.length;a++){var n="undefined"==typeof e[a].value?e[a].text:e[a].value;t.append('<option value="'+n+'">'+e[a].text+"</option>")}},DataTableBatchApi.getCheckBoxValue=function(t){return t.is(":checked")?t.attr("data-trueval"):t.attr("data-falseval")},DataTableBatchApi.formatNumber=function(t){if("undefined"!=typeof DataTableBatchApi.formatNumberOverride)return DataTableBatchApi.formatNumberOverride(t);t+="",x=t.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var e=/(\d+)(\d{3})/;e.test(x1);)x1=x1.replace(e,"$1,$2");return x1+x2},DataTableBatchApi.deformatNumber=function(t){if("undefined"!=typeof DataTableBatchApi.deformatNumberOverride)return DataTableBatchApi.deformatNumberOverride(t);var e=t.toString().replace(new RegExp("[,]","g"),"");return parseFloat(e)};